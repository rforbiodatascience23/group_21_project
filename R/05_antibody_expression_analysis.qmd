---
project: 
  output-dir: /results
title: "08_expression_analysis"
format: html
editor: visual
---

```{r}
#| include: false
library(tidyverse)
library(viridis)
```

### Load Data

```{r}
data <- read_tsv("./../data/03_dat_aug.tsv",
                 show_col_types = FALSE)
```

### Data Analysis

```{r}
#| warning: false
data_long <- data |>
  pivot_longer(cols = c(GAD65, ZnT8, IA_2, IAA),
               names_to = "antibody", 
               values_to = "expression") |>
  group_by(antibody, timepoint, case_control) |>
  summarise(mean_expression = mean(expression,
                                   na.rm = TRUE))

data_long |>
  ggplot(mapping = aes(x = factor(timepoint),
                       y = mean_expression,
                       fill = case_control)) +
  
  geom_bar(stat = "identity",
           position = "dodge",
           alpha = 0.8,
           color = 'black') +
  
  facet_wrap(vars(antibody),
             scales = "free_y",
             nrow = 2) +
  
  labs(x = "Visit",
       y = "Mean Expression",
       fill = "Case/Control",
       title = "Antibody expression across the four visits stratified by case/control") +
  
  scale_fill_viridis(option = 'E',
                     discrete = TRUE) +
  
  theme_minimal() + 
  theme(legend.position = "bottom")
```
