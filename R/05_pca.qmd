---
title: "05_analysis_1.qmd"
format: html
editor: visual
---

```{r}
library("tidyverse")
```

```{r}

data <- read_tsv("./../data/04_aug_clean.tsv")|>
  mutate(across(everything(), 
                ~replace_na(., 0))) 

data_pca <- read_tsv("./../data/04_aug_clean.tsv")|>
  mutate(across(everything(), 
                ~replace_na(., 0))) |>
  select(case_control,GAD65, IA_2, IAA, ZnT8) |>
  select(where(is.numeric)) |> # retain only numeric columns
  scale() |> # normalizing the data 
  prcomp()

# plotting PC coordinates for individuals
data_pca |>
  augment(data) |># add original dataset back in
  ggplot(aes(.fittedPC1, .fittedPC2, 
             color = case_control)) + 
  geom_point(size = 1.5) +
  scale_color_manual(
    values = c(Case = "#D55E00", 
               Control = "#0072B2")
  ) +
  theme_half_open(12) + 
  background_grid() +
    labs(title = "Plot of individuals",
         color = "Case vs Control")

# plotting scree plot for varialbe variation
data_pca |>
  tidy(matrix = "eigenvalues") |>
  ggplot(aes(PC, percent)) +
  geom_col(fill = "#0072B2", 
           alpha = 0.8) + # making the bars slightly translusent 
  scale_x_continuous(breaks = 1:9) +
  scale_y_continuous(
    labels = scales::percent_format(),
    expand = expansion(mult = c(0, 0.01))) +
  geom_line(aes(PC),
            color = "red") +
  theme_minimal_hgrid(12) +
  background_grid() +

  labs(title = "Scree Plot",
       y = "percentage contribution")

# plotting the rotation matrix
arrow_style <- arrow(length = unit(0.2, "cm"), 
                     ends = "first")

data_pca |>
  tidy(matrix = "rotation") |>
  pivot_wider(names_from = "PC", 
              names_prefix = "PC", 
              values_from = "value") |>
  ggplot(aes(x = PC2, y = PC1)) +
  geom_point(alpha = 0) +  # making the points fully transparent
  geom_segment(aes(xend = 0, yend = 0), 
               arrow = arrow_style, 
               color = "black") +
  coord_flip() +
  geom_text(aes(label = column), hjust = 1.2, nudge_x = -0.02, color = "#0072B2") +
  theme_half_open(12) + 
  background_grid() +
  labs(title = "Rotation Matrix")
```
