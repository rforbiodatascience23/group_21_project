---
title: "02_clean"
format: html
editor: visual
---

### Load Tidyverse

```{r}
#| output: false
#| warning: false
library("tidyverse")
```

### Clean Data

```{r}
#| message: false
#| warning: false
read_tsv("./../data/01_dat_load.tsv") |>
  mutate(case_control = case_when(str_detect(sample_tags,"Case") ~ "Case",
                                  str_detect(sample_tags, "Control") ~ "Control",
                                  TRUE ~ NA),
         
         
         id = case_when(str_detect(sample_tags, "Subject") ~ as.double(str_extract(str_extract(sample_tags,"Subject[^,]+"),"\\s\\d+")),
                        str_detect(sample_tags, "Control") ~ as.double(str_extract(str_extract(sample_tags,"Control[^,]+"), "\\s\\d+")),
                        TRUE ~ NA),
         
         timepoint = as.double(str_extract(str_extract(sample_tags,"Timepoint\\s+\\d+[.\\d+]?"), "\\s+\\d+[.\\d+]?")),
         
         gender = case_when(str_detect(sample_tags, "Female") ~ "Female",
                            str_detect(sample_tags, "Male") ~ "Male"),
         
         ethnicity = case_when(
          str_detect(sample_tags, "Non-Hispanic") ~ "Non-Hispanic",
          str_detect(sample_tags, "Hispanic") ~ "Hispanic",
          TRUE ~ as.character(sample_tags)),
          
         race = case_when(
          str_detect(sample_tags, "Caucasian") ~ "Caucasian",
          str_detect(sample_tags, "Asian") ~ "Asian",
          TRUE ~ as.character(sample_tags)),
         
         age = as.double(str_extract(str_extract(sample_tags,"\\d{0,3}.?\\d+\\s+Years\\s{0}"), "\\d{0,3}.?\\d{0,3}")),
         
         
         age_diagnosis = as.double(str_extract(str_extract(sample_tags,"\\d{0,3}.?\\d+\\s+Years\\s{1}at\\sdiagnosis"), "\\d{0,3}.?\\d{0,3}")),
         
         
         age_visit = as.double(str_extract(str_extract(sample_tags,"\\d{0,3}.?\\d+\\s+Years\\s{1}at\\svisit"), "\\d{0,3}.?\\d{0,3}")),
         
         GAD65 = as.double(str_extract(str_extract(sample_tags,"GAD65\\s+\\d+"), "\\s+\\d+")),
         
         
         IA_2 = as.double(str_extract(str_extract(sample_tags,"IA\\-{1}2{1}\\s+\\d+"), "\\s+\\d+")),
         
         
         IAA = as.double(str_extract(sample_tags, "(?<=IAA )[-+]?[0-9]*\\.?[0-9]+")),
         
         
         ZnT8 = as.double(str_extract(sample_tags, "(?<=ZnT8\\s)\\d+\\.\\d+"))
        ) |> 
         
  
    mutate(
      #HLA-A
      HLA_A = str_c(
        str_extract_all(
          str_c(
            str_extract_all(
              sample_tags,
              pattern = "HLA\\-{1}A\\*{1}\\d{4}"),
            sep = ","), "\\d{4}"), sep = ","),

      #HLA-B
      HLA_B = str_c(
        str_extract_all(
          str_c(
            str_extract_all(
              sample_tags,
              pattern = "HLA\\-{1}A\\*{1}\\d{4}"),
            sep = ","), "\\d{4}"), sep = ","),
      
      #HLA-C
      HLA_C = str_c(
        str_extract_all(
          str_c(
            str_extract_all(
              sample_tags,
              pattern = "HLA\\-{1}A\\*{1}\\d{4}"),
            sep = ","), "\\d{4}"), sep = ","),
      
           HLA_DPA1 = str_extract(str_extract(sample_tags, pattern = "HLA\\-{1}DPA1\\*{1}\\d{4}"), "\\d{4}"),
           HLA_DPB1 = str_extract(str_extract(sample_tags, pattern = "HLA\\-{1}DPB1\\*{1}\\d{4}"), "\\d{4}"),
           HLA_DQA1 = str_extract(str_extract(sample_tags, pattern = "HLA\\-{1}DQA1\\*{1}\\d{4}"), "\\d{4}"),
           HLA_DQB1 = str_extract(str_extract(sample_tags, pattern = "HLA\\-{1}DQB1\\*{1}\\d{4}"), "\\d{4}"),
           HLA_DRB1 = str_extract(str_extract(sample_tags, pattern = "HLA\\-{1}DRB1\\*{1}\\d{4}"), "\\d{4}")
         ) |> 
         
  select(!sample_tags) |>
  
  write_tsv("./../data/02_dat_clean.tsv")
```

PCA analysis

Barplot: Expression across the four visits stratified by case/control

Boxplot: Diagnostics age

Heatmap: Alleles
